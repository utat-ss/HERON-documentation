

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Our Toolchain &mdash; UTAT Space Systems Documentation 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="lib-common" href="lib-common.html" />
    <link rel="prev" title="Test Harness" href="test-harness.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> UTAT Space Systems Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/rtsys.html">Real-Time Embedded Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/avr-toolchain.html">The AVR Toolchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/install.html">Software Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/install-mac.html">Software Installation - macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/install-win.html">Software Installation - Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/install-linux.html">Software Installation - Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/atmega32m1.html">The ATMega32M1 Microcontroller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/hello-world.html">Hello World ATMega32M1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/git-and-github.html">Git and Github</a></li>
</ul>
<p class="caption"><span class="caption-text">Software and Programming</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../software-and-programming.html">Software and Programming</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="software-workflow.html">Software Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="test-harness.html">Test Harness</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Our Toolchain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#our-avr-toolchain">Our AVR Toolchain</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#coding-with-libraries">Coding with Libraries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lib-common.html">lib-common</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib-common.html#switch-lib-common-to-a-different-branch">Switch lib-common to a Different Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="uart-terminal.html">UART Terminal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embedded/microcontrollers.html">Microcontrollers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embedded/registers.html">Registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embedded/interrupts.html">Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embedded/avr-fuses.html">AVR Fuses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communication-protocols/communication-protocols.html">Communication Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communication-protocols/can.html">CAN (Controller Area Network)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communication-protocols/can-mobs.html">Message Objects (MObs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communication-protocols/can-mob-allocation.html">MOb Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communication-protocols/spi.html">SPI (Serial Peripheral Interface)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communication-protocols/spi-bus.html">SPI Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communication-protocols/spi-using-spi.html">Using our SPI Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communication-protocols/uart.html">UART (Universal Asynchronous Receiver Transmitter)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/introduction.html">C Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/bitwise-operators.html">Bitwise Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/control-structures.html">Control Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/header-files.html">Header Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/header-files.html#define">#define</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/header-files.html#typedef">typedef</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/pointers.html">Pointers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/structs.html">Structs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/c_h_files.html"><code class="docutils literal"><span class="pre">.c</span></code> and <code class="docutils literal"><span class="pre">.h</span></code> Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/binary-hex-literals.html">Binary (0b) and Hexadecimal (0x) Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/integer-types.html">Integer Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/print-formatting.html">Print Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-programming/volatile-variables.html">Volatile Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-guide/style-guide.html">Software Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-guide/technical.html">Technical</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-guide/formatting.html">Formatting</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Electronics and Altium</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../electronics-and-altium.html">Electronics and Altium</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">UTAT Space Systems Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../software-and-programming.html">Software and Programming</a> &raquo;</li>
        
      <li>Our Toolchain</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/software-tools/our_toolchain.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="our-toolchain">
<span id="our-toolchain"></span><h1>Our Toolchain<a class="headerlink" href="#our-toolchain" title="Permalink to this headline">¶</a></h1>
<p>Developing code for a real-time embedded system like HERON Mk II as part of a
large, interdisciplinary team of programmers is no easy task, and we have
collected a set of tools to make the process as effective as possible. To make
the software we develop reliable and sustainable, it is crucial to properly set
up, use, and understand the tools described in this article.</p>
<div class="section" id="background">
<span id="background"></span><h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>The ATmega32M1 microcontroller we use is a part of the Atmel AVR family. Atmel
is the company that produces them (and is now owned by Microchip), and AVR
refers to the architecture and the instruction set used in these
microcontrollers (MCU for short). As discussed earlier, in order to program
these devices, we need to translate the C code we write into machine code
through a <em>Compiler</em>. The compiled machine code is then loaded to the AVR
device through a protocol called <em>In-Circuit Serial Programming</em>, ISP for
short, which is just a fancy name for “program your device with just 6 wires so
you don’t have to rip it out of your circuit board every time you want to
change a line of code”. This is a standard feature nowadays, but at some point
in the past “burning” a program onto your MCU was a much harder, non-reversible
process.</p>
<p>Often, the process of writing code, compiling it for the specific MCU that you
are using, and loading that program onto the MCU is done through what is called
an <em>Integrated Development Environment</em>, or an IDE. Atmel has a nice IDE for
its own microcontrollers, named <em>Atmel Studio</em>, and it integrates and
simplifies the process a fair bit. However, for HERON Mk II, we’ve decided to
move to a more bare-bones approach that lets you see a little deeper into the
inner workings of the process. This approach also allows us to keep better
track of the <em>libraries</em> that we use in our code. Libraries, which are
pre-written, self-contained pieces of useful code that can be reused, make up
most of the code in any embedded system, and we have a few that we have written
that you will definitely end up using if you write any code for HERON.</p>
<p>We call the set of tools we use to develop and program our MCUs our
<em>toolchain</em>, and I’ll give a brief overview of what every part of it is about.</p>
</div>
<div class="section" id="our-avr-toolchain">
<span id="our-avr-toolchain"></span><h2>Our AVR Toolchain<a class="headerlink" href="#our-avr-toolchain" title="Permalink to this headline">¶</a></h2>
<p>From the point of view of the programmer, there are three steps to get some
code on your MCU. For the sake of simplicity, let’s call them the following:</p>
<ul class="simple">
<li><strong>Code</strong>: Use any text editor you want on your computer to create the <code class="docutils literal"><span class="pre">.c</span></code> and <code class="docutils literal"><span class="pre">.h</span></code> files and make use of libraries.</li>
<li><strong>Make</strong>: Use a compiler to compile your code into machine code</li>
<li><strong>Upload</strong>: Use a <em>programmer</em>, a small circuit board with wires on either end, to connect your computer to your MCU and to upload the program</li>
</ul>
<p>Once you’ve completed the setup of the environment, this whole process will be
as simple as saving your code, and typing the following into your command line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">upload</span>
</pre></div>
</div>
<p>The rest of this section describes these steps in more detail, and explains how
they apply to our specific project.</p>
<div class="section" id="coding-with-libraries">
<span id="coding-with-libraries"></span><h3>Coding with Libraries<a class="headerlink" href="#coding-with-libraries" title="Permalink to this headline">¶</a></h3>
<p>Libraries are collections of well-tested, useful, and nicely documented code
that can be <em>included</em> in many projects. They can have many different purposes,
including:</p>
<ul class="simple">
<li>provide easy access to basic functions, such as “wait 50 ms”, “turn pin PB5
on” or “allocate 8 bits of memory for this integer”</li>
<li>allow easy use of complex features of your microcontroller, such as the SPI
or CAN data transfer protocols</li>
<li>let you use an external device (a <em>peripheral</em>), such as writing data to an
SD card or running a motor.</li>
</ul>
<p>There are three sources of libraries that we use:</p>
<ol class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/C_standard_library"><strong>Standard C
Libraries</strong></a>: a set of
libraries that can be used in any given C program running on any device.
Functions from these libraries are used so often that you don’t think about
them much. Math functions, variable types and sizes, floating point numbers,
strings are all dealt with here.</li>
<li><a class="reference external" href="http://www.nongnu.org/avr-libc/user-manual/overview.html"><strong>avr-libc</strong></a>: a
library created specifically for writing C programs for AVR
microcontrollers. It lets you do things that are specific to the
microcontroler you are using. For example, it can let you read/write to the
I/O pins on your microcontroller; it can allow you to count a certain number
of milliseconds to have accurate delays; or it can provide access to certain
power-saving functions.</li>
<li><a class="reference external" href="https://github.com/HeronmkII/lib-common"><strong>lib-common</strong></a>: our
constantly-evolving, home-made library just for HERON Mk II. Here we have
functions that are used in all of the different subsystems on the satellite,
protocols that allow the subsystems to communicate, and drivers for
peripherals that are used on the satellite.</li>
</ol>
<p>Since libraries typically make up most of a project, it is not convenient to
store them as <code class="docutils literal"><span class="pre">.c</span></code> and <code class="docutils literal"><span class="pre">.h</span></code> files with the rest of your code. If you were to do
that, they would need to be recompiled every time you make a small change in
your main code, which would take ages. Instead, they are pre-compiled and
stored in <code class="docutils literal"><span class="pre">.a</span></code> files, which you can see in <code class="docutils literal"><span class="pre">lib-common/lib/</span></code> in the link above.
This is why later on, once you have completed setting up the toolchain, you
will not be able to compile one of the subsystem projects until after you have
compiled the contents of lib-common.</p>
<p>Any library can be used in your code as long as it is accessible to the
compiler, however it needs to be included properly. The snippet below shows an
example of how to include various libraries and other project files in your
main code (taken from obc.h in the <a class="reference external" href="/github.com/HeronMkII/obc">On-Board Computer
code</a>). Note how the angle brackets are used for
the libraries, and double quotes are used for the project files - <a class="reference external" href="https://stackoverflow.com/questions/3162030/difference-between-angle-bracket-and-double-quotes-while-including-heade">can you
guess
why</a>?</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">standard</span> <span class="n">C</span> <span class="n">libraries</span>
<span class="c1">#include      &lt;stdbool.h&gt;</span>
<span class="c1">#include      &lt;stdint.h&gt;</span>

<span class="o">//</span> <span class="n">avr</span><span class="o">-</span><span class="n">libc</span> <span class="n">includes</span>
<span class="c1">#include     &lt;avr/io.h&gt;</span>
<span class="c1">#include     &lt;util/delay.h&gt;</span>

<span class="o">//</span> <span class="n">lib</span><span class="o">-</span><span class="n">common</span> <span class="n">includes</span>
<span class="c1">#include     &lt;spi/spi.h&gt;</span>
<span class="c1">#include     &lt;uart/uart.h&gt;</span>
<span class="c1">#include     &lt;uart/log.h&gt;</span>
<span class="c1">#include     &lt;can/can.h&gt;</span>

<span class="o">//</span> <span class="n">project</span> <span class="n">file</span> <span class="n">includes</span>
<span class="c1">#include     &quot;rtc.h&quot;</span>
<span class="c1">#include     &quot;mem.h&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lib-common.html" class="btn btn-neutral float-right" title="lib-common" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="test-harness.html" class="btn btn-neutral" title="Test Harness" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, University of Toronto Aerospace Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>